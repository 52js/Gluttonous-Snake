<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è´ªåƒè›‡</title>
</head>
<body>
  <canvas id="can" width="400" height="400" style="background: black;"></canvas>
  <script>
    const ctx = document.getElementById('can').getContext('2d') //è·å–canvaså…ƒç´ å¹¶æŒ‡å®šä»¥2dæ–¹å¼ç»˜åˆ¶
    let body = [
      [3,6],
      [4,6],
      [5,6]
    ] //åˆå§‹åŒ–ğŸèº«ä½“ï¼Œåˆšå‡ºæ¥3èŠ‚çš„åæ ‡
    let food = [10, 10] //åˆå§‹åŒ–é£Ÿç‰©ä½ç½®
    let direction = [1, 0] //åˆå§‹åŒ–æ–¹å‘
    let interval //å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç”¨äºå­˜å‚¨è®¡æ—¶å™¨id
    window.onload = function() {  
      interval = setInterval(() => {
        render()
      }, 130);
    }

    function render() {  
      // å¦‚æœç¢°åˆ°å¢™åˆ™æ¸¸æˆç»“æŸ
      if (check()) {
        alert('game over')
        clearInterval(interval)
      }
      let length = body.length
      // ç§»åŠ¨ğŸèº«ä½“
      for (let i = 0; i < length - 1; i++) {
        body[i][0] = body[i + 1][0]
        body[i][1] = body[i + 1][1]
      }
      body[length - 1][0] += direction[0]
      body[length - 1][1] += direction[1]

      ctx.clearRect(0, 0, 400, 400) //æ¸…ç©ºcanvaså…ƒç´ é‡Œçš„æ‰€æœ‰åƒç´ 
      for (let i = 0; i < length; i++) {
        draw(body[i][0], body[i][1], 'red') //ğŸèº«ä½“è®¾ç½®ä¸ºçº¢è‰²
      }
      draw(food[0], food[1], 'yellow') //ğŸè®¾ç½®ä¸ºé»„è‰²
    }

    function check() {
      let header = body[body.length - 1] //ğŸå¤´çš„ä½ç½®
      if (header[0] < 0 || header[0] > 19 || header[1] < 0 || header[1] > 19) return true //å¦‚æœğŸå¤´è¶…è¿‡äº†èŒƒå›´ï¼Œå°±è·³å‡º
      if (header[0] == food[0] && header[1] == food[1]) {
        body.unshift([0, 0]) //å¦‚æœğŸå¤´çš„ä½ç½®è·ŸğŸçš„ä½ç½®ç›¸åŒï¼Œåˆ™ğŸèº«ä½“åŠ ä¸€èŠ‚
        food[0] = ~~(Math.random() * 20) 
        food[1] = ~~(Math.random() * 20)
        // éšæœºğŸçš„åæ ‡
      }

      for (let i = 0; i < body.length - 1; i++) {
        // åˆ¤æ–­æ˜¯å¦å’¬åˆ°è‡ªå·±
        if (body[i][0] == header[0] && body[i][1] == header[1]) {
          return true
        }
      }
      return false
    }

    // canvasåŒºåŸŸå¡«å……
    function draw(x, y, color) {  
      ctx.fillStyle = color
      ctx.fillRect(x * 20 - 1, y * 20 - 1, 18, 18)
    }

    // é€šè¿‡æ–¹å‘é”®æ§åˆ¶ğŸçš„æ–¹å‘
    window.onkeydown = function (e) {  
      switch(e.keyCode) {
        case 37:
          if (direction[0] != 1) {
            direction = [0, 0]
            direction[0] = -1
            break
          }
        case 38:
          if (direction[1] != 1) {
            direction = [0, 0]
            direction[1] = -1
            break
          }
        case 39:
          if (direction[0] != -1) {
            direction = [0, 0]
            direction[0] = 1
            break
          }
        case 40:
          if (direction[1] != -1) {
            direction = [0, 0]
            direction[1] = 1
            break
          }
      }
    }
  </script>
</body>
</html>